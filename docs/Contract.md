# 数据库设计

Mariadb5.5+，使用XtraDB/InnoDB存储引擎，字符集使用UTF-8

## 设计原则

1. 如果表名user, 主键为id，则外键命名为user（注：Django会自动命名为user_id）
1. 表名为名词，单数形式
1. 表名的复数形式直接追加s即可，不必考虑英语中关于复数的语法
1. 所有表都包括两个字段，created_at|updated_at
1. created_at，插入记录时自动更新，应用层代码无需处理
1. updated_at，更新记录时自动更新，应用层代码无需处理
1. 若字段名前缀为is_，表示字段类型为布尔类型
1. 外键表必须还有name字段

## 局限性

无

## 表设计

### state - 运行状态（pending、running、stoped、zombied、crashed）

支持HTTP请求方法：GET|POST|PUT|PATCH|DELETE
唯一性约束：name

1. id - 自动增长，主键
1. name - 名称，不超过32字节
1. desc - 描述，不超过128字节
1. priority - 优先级

### operating_system - 操作系统（Android、iOS）

支持HTTP请求方法：GET|POST|PUT|PATCH|DELETE
唯一性约束：name

1. id - 自动增长，主键
1. name - 名称，不超过32字节
1. desc - 描述，不超过128字节
1. priority - 优先级

### vendor - 手机厂商

支持HTTP请求方法：GET|POST|PUT|PATCH|DELETE
唯一性约束：name

1. id - 自动增长，主键
1. name - 名称，不超过32字节
1. desc - 描述，不超过128字节
1. priority - 优先级

### brand - 手机品牌

支持HTTP请求方法：GET|POST|PUT|PATCH|DELETE
唯一性约束：plugin_plan,plugin

1. id - 自动增长，主键
1. vendor - 外键
1. name - 名称，不超过32字节
1. desc - 描述，不超过128字节

### device - 设备

支持HTTP请求方法：GET|POST|PUT|PATCH|DELETE
唯一性约束: serial

1. id - 自动增长，主键
1. operating_system - 外键
1. brand - 外键
1. serial - 设备编号（DU2TAN149K054894）
1. product - 产品编号（H60-L02）
1. hardware - 处理器型号（Kirin920） -- adb shell cat /proc/cpuinfo
1. mem - 内存（2G） -- adb shell cat /proc/meminfo|grep MemTotal
1. resolution - 屏幕分辨率（1920x1080）
1. status - 设备状态

### application - 应用

支持HTTP请求方法：GET|POST|PUT|PATCH|DELETE
唯一性约束: name

1. id - 自动增长，主键
1. name - 名称，不超过32字节
1. desc - 描述，不超过128字节
1. priority - 优先级

### application_version - 应用版本

支持HTTP请求方法：GET|POST|PUT|PATCH|DELETE
唯一性约束: name

1. id - 自动增长，主键
1. application - 外键
1. operating_system - 外键
1. version - 版本字符串，不超过32字节
1. link - APP安装文件的下载路径，不超过256字节

### requirement - 测试需求

支持HTTP请求方法：GET|POST|PUT|PATCH|DELETE
唯一性约束: name

1. id - 自动增长，主键
1. application_version - 外键
1. name - 名称，不超过32字节
1. desc - 描述，不超过128字节

### case - 测试用例

支持HTTP请求方法：GET|POST|PUT|PATCH|DELETE
唯一性约束: name

1. id - 自动增长，主键
1. requirement - 外键
1. name - 名称，不超过32字节
1. desc - 描述，不超过128字节
1. script - 脚本附件，压缩文件，不超过128字节

### scheduler - 调度器

支持HTTP请求方法：GET|POST|PUT|PATCH|DELETE
唯一性约束：name

1. id - 自动增长，主键
1. name - 名称，不超过32字节
1. desc - 描述，不超过128字节
1. priority - 优先级

### task - 测试任务

支持HTTP请求方法：GET|POST|PUT|PATCH|DELETE
唯一性约束：name

1. id - 自动增长，主键
1. scheduler - 外键
1. name - 名称，不超过32字节
1. desc - 描述，不超过128字节

### task_case - 任务-用例

支持HTTP请求方法：GET|POST|PUT|PATCH|DELETE
唯一性约束: task,case

1. id - 自动增长，主键
1. task - 外键
1. case - 外键
1. count - 运行次数

### task_device - 任务-设备

支持HTTP请求方法：GET|POST|PUT|PATCH|DELETE
唯一性约束: task,case

1. id - 自动增长，主键
1. task - 外键
1. device - 外键

### task_runtime - 运行时

支持HTTP请求方法：GET|POST|PUT|PATCH|DELETE
唯一性约束：task,device

1. id
1. task - 外键
1. state - 外键
1. case - 外键
1. scheduler - 外键
